import xlrd
import re
import jieba

jieba.load_userdict('./dict.txt')
def get_tcs(juji,times,j,sheet_num):
    print('+++++++++++++++++++++++++++++++++++++')
    if sheet_num==0:
        type=j
    else:
        type=j+10
    txt_path='e:/å¼¹å¹•2/'+juji[0:-2]+'/'+str(int(juji[-2:]))+'.txt'
    print(txt_path)
    fr=open(txt_path,'r',encoding='utf-8')
    lines=fr.readlines()
    # print(txt_path,times,j)
    for i in times:
        start=i.split('~')[0]
        start_min=start.split(':')[0]
        start_sec=start.split(':')[1]
        st=int(start_min)*60+int(start_sec)
        end=i.split('~')[1]
        end_min=end.split(':')[0]
        end_sec = end.split(':')[1]
        ed=int(end_min)*60+int(end_sec)
        print(st,ed)
        #print(end,start)
        tcss=[]
        for line in lines[1:]:
            second=float(line.split('  ')[0])
            tcs=line.split('  ')[2].strip('\n')
            if second>=st and second<ed:
                tcss.append(str(second).split('.')[0]+' '+tcs)
                #print(str(second).split('.')[0]+' '+tcs)
        write_tcs(tcss,type)



def get_xlsx_data():
    workbook=xlrd.open_workbook(r'e:/å¼¹å¹•2/highlight_not.xlsx')
    for i in range(0,2):
        print(str(i)+'===================================================')
        sheet=workbook.sheet_by_index(i)
        sheet_num=i
        nrows=sheet.nrows
        ncols=sheet.ncols
        print(nrows)
        for i in range(1,nrows):
            juji=sheet.cell_value(i,0)
            for j in range(1,ncols):
                times=[]
                cell_cont=sheet.cell_value(i,j)
                if cell_cont!='':
                    if '|' in cell_cont:
                        times=cell_cont.split('|')
                    else:
                        times=[cell_cont]
                #print(times)
                if times!=[]:
                    get_tcs(juji,times,j,sheet_num)



def write_tcs(tcss,type):
    print('##################################3')
    print(type,tcss)
    fw=open('./tcs_train.txt','a',encoding='utf-8')
    fw.write('type:'+str(type)+'\n')
    for i in tcss:
        time=i.split(' ')[0]
        cont=i.split(' ')[1]
        cont = re.sub('[\s+\.\!\/_,$%^*(+\"\')]+|[-ï¼›'
                   'âœºâ—Ÿâ› à¸±âˆ—â—žâ” ã‚â€µ â–¡ â€²â—¢ â˜„ä¸¶â”â”» à¸ºâ”»â™¡ðŸ’”â™¥â¤ðŸ’ðŸ’–ðŸ’™ðŸ’—ðŸ’žðŸ’•â¤ ðŸ’™ï¸ðŸ’ðŸ’“Ä¹Ì¯Ì¿Ì¿â–€â†™\[\]â€“ï¼šðŸ™ƒáƒšâ•¹à¯°Å'
                   'Ð¼Ñ„Ñ€Ñ…ÑÑƒÑŠÑŽÑŒÑÑ‹Ð‘ÑÐ–Ð“Ð•Ðâ†‘Ð¬ÐºÐ¶Ñ‘Ð±Ð¸Ñ„Ñ€Ñ‚Ñ†ÑÑ…Ð¼Ð‘ÐµÑÐ³Ð¿Ð»Ñ…Ð¾Ð¹â—¡Ð°Ð¡ÑƒÐºðŸ’£ðŸ‡³ðŸ˜„â•¯ðŸ‡¨â˜…â™‚ðŸ˜‚ðŸ’˜â•°'
                   'ã€–ã€—Û¶ã’ã¡ã‚ƒé§„ã¶ã‚Šã‚â–¼ðŸ‘²ðŸ¶ðŸ˜¹âœ‹ã‚Šã‚¨ãƒ´ã‚¡ãƒ³ã‚²ãƒªã‚ªãƒ³â€˜â—”â—¡ãŠãƒŽÂ°â€µâ€²â™€â‰ ãƒŽã‚¸ãƒ§\\â‰§â‰¦Î¿ã‚Šâ•¯Â°ï¸µËŠáµ’Ì´Ì¶Ì·Ì¤ê‡´áµ’Ì´Ì¶Ì·Ì¤Ë‹ '
                   'âŠƒâ–¡â½â½à¬˜â¬…â†â†‘â†“â†’â†˜â„¢â”´â€™â€µâ–¡â€²ðŸŽ‰ðŸ‘‡ðŸ‘â”â”»ã€ƒâ”€Î„âœ¹à¨Šâ€µâ”´ã‚§ã‚©ã‚³ã‚ªã‚£ã‚©ã‚³ã€…ãƒ¯ãƒ à²¥ï¿¢ï¹à®‡çš¿ìœ ì „ìžã€Œã…ãã…ã‰ãŠã‚Šã£â€²Ãœâ˜€á†ºç½’ë…ì¼ë¯¸êµ­ãƒ¡ãƒªâ—¦Ë™'
                   ';âŒ“Â°â‰ºãžã¿Ô…ã²ã‚ŠÂ¯ã…‚ã†ï¼‹|ã€”ã€•ë…ì¼ì—ëŠ”ðŸ‘£ðŸ‘§ðŸ‘¦ðŸ‘¨ðŸ‘©â€µðŸŒ¸â–¡â€²ðŸ‘´ðŸ‘¼ðŸ‘¶ðŸŽ…â—•ðŸ’‚ðŸƒðŸŒ¶ðŸ“ðŸŽ€ðŸƒðŸ’„â™¡ðŸŒ±'
                   'à¸± à¹‡ à¹‡ à¸±à¸± à¹‡ à¹‡ à¸±ï¹‹ÍžÍŸ ÍŸÍžâ—ŠÃ² â—Š Ã³Âºã‚â¬›â– â–²Ã²Ã³Û¶à²¡\â‰§âž•â‰¦âŒ„Ìà²¡âˆšåâ˜…â– â˜†ãƒ˜ï¸¶ï¸¿ï¸¶â•®â•¯ï¼¿â•°â•­â—” â—¡ â—”Ð·ã€á´—âœª`âˆ‡ã£âˆ‘ì‚¬ëŒ€ë°œê²¬â€ºâ€¹ðŸ‘„Â¦â€â˜†Ê˜ðŸ”¥Åãƒ¾â˜œðŸŽðŸ’‘ðŸ‘‘âš†â†—ðŸ’ƒâ–„â–ˆâ–€ðŸ‘¹ðŸ…â‰¡ðŸ‘‘ðŸ—ðŸ³ðŸŒ¶ðŸšðŸ²ðŸ±ðŸ›ðŸ£ðŸ¥ðŸðŸ•ðŸ›ðŸŸðŸ©ðŸ«ðŸ¿ðŸª '
                   'ðŸ˜–â•¥à¹“ã­ï¼»ï¼½â†ê’³Ë‹Ì‹ËŠ;Ë˜å£â¢ï¼žâ”â”›ï¹ƒï¼âˆ©ðŸŒ½âœ˜â“â–“ðŸ”ðŸ´ðŸ·ðŸ˜³ðŸ‘†â™ªðŸ‘ âŒ£ Ë˜áƒ¦ðŸš¶ðŸˆðŸŽŽðŸ‡¨ðŸ‡³ã€ƒâ”¯â”ðŸ”ªâœˆðŸ‰â™¬â™©â™«â™ªðŸ’©âŒâ­•ðŸŽŠðŸœðŸ˜ŽðŸ•·â—â€¿â—œðŸ˜±ðŸ‡ðŸ“ðŸˆðŸ’ï¹€â–‚ðŸ‘ðŸ ðŸ––ðŸžðŸŒ¹ðŸŽ¤ðŸŽ¶ðŸ¯ðŸ–ðŸðŸ¤ðŸ‘ðŸ³âœ¿ðŸ™ŒðŸŽŽðŸ‘„ðŸ‘‰ðŸ‘Œâ™€ðŸµðŸ‘£ðŸ¾ðŸŒðŸ˜ðŸ˜ðŸ‘»ðŸ½ðŸ£ðŸ›ðŸ’‹ðŸ˜¡ðŸ˜¨ðŸ˜‰ðŸ˜±ðŸŒšðŸŒðŸ˜§ðŸ˜ˆðŸ‡¨ðŸ‡³ðŸ˜ªðŸ˜ŒðŸ˜˜ðŸ˜žðŸ˜ðŸ˜â˜»â‰¡ðŸ˜ðŸ˜ðŸŒšðŸ˜•ðŸ˜…ðŸ˜­ðŸ˜ŠðŸ˜„ðŸ˜‚ã‰¨à©­ âœ§ðŸ‘ðŸ¢Ë¶'
                   'â€¾ á·„â€•â€•Â«Â°\\ãƒ˜Ë‡ â€¸ Ë‡ï¼¾ãƒ¯âˆ ãƒŽÏ€âˆ¼ã¸'
                   'â€»è‰¹0123456789qwertyuiopasdfhjklzxcvnQWERTYUIOPASDFHJKLZXCVNã€‹'
                   'â…§âŠ‚ãƒ»ã……ã…‡ï½ƒï½–ã‚ãï¼¯â˜žã€Šâ€¢ã‚·ã–ã³ã™ãƒ‰ã»ã°ãƒ‘ãƒˆã‹ã‚„ã¦ã— ÖŸã‚‡ã ã©ã‹ã‚ðŸ›ã¦ã ã‚’ï¼…ëˆˆã‚¢ã‚¹ã‚«ã‚¼ãƒ†ã¯ã‚ˆã†ã«ãã¤ã¥ã¨'
                   'â‰–ãƒŠÙˆÎ¸ã€Žã€ï¹ê’¦ àºµã‚œ\\{}ããã‚Œã„ãŸã‘ãªã‚‰ã•ãˆã¾ã‚‚ã¨ã“ã«ã‚“ã§ã‚‹ã‚ãŸãŒ\.\.\.ï¼/ðŸ˜”ðŸ˜—ðŸ˜›'
                   'ï¼ ãƒ¢ï¼¯ã‚žï¼¼â„ã¥= - =Ã—â„ƒ â‰ˆÏï½ž!_:à¹€ à¸µï¾‰ï¼Šâ€¦Îµá•ª Â· Ð”\\ Â·> <ï¾ŸÂ·!ï½€âŠ™Â¬ã®Î£ Ð´ãƒ½ãƒ¼'
                   '()ç¬êˆâ–½Ì€âˆ€â€¢Ì Ï‰à¸… /â—‹â€”â—^*Ù©Â´âˆ€ à¸‡à¹‘+â€”â€”()â–ƒ?ã€ã€‘â€œâ€ï¼ï¼Œã€‚ï¼Ÿã€~@#ï¿¥%â€¦â€¦&*ï¼ˆï¼‰,ï¼š-]+', '', cont)
        if len(cont) <= 1:
            continue
        else:
            str_load = jieba.cut(cont)
            fw.write(time+'  '+' '.join(str_load) + '\n')
    fw.close()


get_xlsx_data()
root='e:/å¼¹å¹•2'